#!/usr/bin/env python3
import os
import sys
import tarfile
import urllib.request


def get_base_directory():
    base_directory = os.path.dirname(os.path.dirname(__file__))
    sys.path.insert(0, base_directory)
    os.chdir(base_directory)
    return base_directory


def main():
    base_directory = get_base_directory()

    from boxman import Boxman, Config, parse_args

    config = Config(base_directory)
    parsed_arguments = parse_args()
    print(parsed_arguments)
    boxman = Boxman(config)
    boxman.run(parsed_arguments)
    # print(config.options.root_dir)
    # for repository in config.repositories:
    #     print(repository.database_url)
    #     db_file = f"{repository.name}.db"
    #     if not os.path.isfile(db_file):
    #         urllib.request.urlretrieve(repository.database_url, db_file, reporthook=progress)
    #     else:
    #         print(os.path.getmtime(db_file))
    #     if not tarfile.is_tarfile(db_file):
    #         print("WTF!")
    #     with tarfile.open(db_file) as t:
    #         for member in t.getmembers():
    #             print(member.name)
    #             if "desc" in member.name:
    #                 output = t.extractfile(member)
    #                 print(output.read().decode('utf-8'))
    #                 t.close()


if __name__ == "__main__":
    main()
